<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Synergy</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  
  <div id="header"></div>

  <div class="layout">
    
    <div id="menu"></div>

    
    <div id="conteudo"></div>

    <div id="friends"></div>
  </div>

  <div id="footer"></div>

  <script>
    // Se não estiver logado, volta pro login
    if (localStorage.getItem('logado') !== 'true') {
      window.location.href = 'index.html';
    }

    // Carrega arquivos externos
    async function carregarParcial(id, arquivo) {
      const el = document.getElementById(id); 
      try {
        const resposta = await fetch(arquivo); 
        el.innerHTML = await resposta.text(); 
      } catch {
        el.innerHTML = `<p>Erro ao carregar ${arquivo}</p>`; 
      }
    }

    // Carrega o conteúdo da página principal 
    async function carregarConteudoPrincipal() {
      const params = new URLSearchParams(window.location.search); 
      const pagina = params.get('page') || 'feed'; 
      const url = `pages/${pagina}.html`; 

      try {
        const resposta = await fetch(url); 
        if (!resposta.ok) throw new Error(); 
        document.getElementById('conteudo').innerHTML = await resposta.text(); 
      } catch {
        document.getElementById('conteudo').innerHTML = '<h2>Página não encontrada</h2>'; 
      }
    }

    // Função que evita que a página recarregue
    function configurarLinksInternos() {
      document.body.addEventListener('click', function (e) {
        if (e.target.tagName === 'A' && e.target.getAttribute('href').startsWith('?page=')) {
          e.preventDefault(); 
          const url = new URL(e.target.href); 
          history.pushState({}, '', url); 
          carregarConteudoPrincipal(); 
        }
      });
    }

    // Quando o site carregar, ele inclui os componentes:
    window.addEventListener('load', () => {
      carregarParcial('header', 'includes/header.html');      
      carregarParcial('menu', 'includes/menu.html');         
      carregarParcial('friends', 'includes/friends.html');  
      carregarParcial('footer', 'includes/footer.html');
      carregarConteudoPrincipal();                         
      configurarLinksInternos();                          
    });

    // Se o usuário clicar em voltar ou avançar no navegador, recarrega o conteúdo certo
    window.addEventListener('popstate', carregarConteudoPrincipal);

  function sair() {
    localStorage.removeItem('logado');
    window.location.href = 'index.html';
  }
  </script>

</body>
</html>
